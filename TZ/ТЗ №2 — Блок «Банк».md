–í—ã –∞–±—Å–æ–ª—é—Ç–Ω–æ –ø—Ä–∞–≤—ã ‚Äî –≤ –ø—Ä–µ–¥—ã–¥—É—â–µ–º –æ—Ç–≤–µ—Ç–µ —è –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏–ª **–æ—á–∏—â–µ–Ω–Ω—É—é –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—É—é**, –Ω–æ **—Å–æ–∫—Ä–∞—â—ë–Ω–Ω—É—é** –≤–µ—Ä—Å–∏—é –¢–ó ‚Ññ2, —É–±—Ä–∞–≤ –¥—É–±–ª–∏ –∏ –∏–∑–±—ã—Ç–æ—á–Ω–æ—Å—Ç—å.

–¢–µ–ø–µ—Ä—å —è –ø–æ–¥–≥–æ—Ç–æ–≤–ª—é **–º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –ø–æ–¥—Ä–æ–±–Ω—É—é, –ø–æ–ª–Ω—É—é, —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏ –Ω–∞—Å—ã—â–µ–Ω–Ω—É—é –≤–µ—Ä—Å–∏—é –¢–ó ‚Ññ2 ‚Äî –ë–ª–æ–∫ ¬´–ë–∞–Ω–∫¬ª**, –≤–∫–ª—é—á–∞—é—â—É—é:

- ‚úÖ –í—Å–µ UI-–æ–ø–∏—Å–∞–Ω–∏—è **–¥–æ—Å–ª–æ–≤–Ω–æ –∏–∑ –≤–∞—à–∏—Ö —Ñ–∞–π–ª–æ–≤** (`CreateCredit ‚Äî –∫–æ–ø–∏—è.txt`, `EditCredit ‚Äî –∫–æ–ø–∏—è.txt`, `Credits ‚Äî –∫–æ–ø–∏—è.txt`)
- ‚úÖ –í—Å–µ —Ñ–æ—Ä–º—É–ª—ã, –ø—Ä–∏–º–µ—Ä—ã, –±–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª–∞ –∏–∑ `TZ4.md` –∏ GitHub
- ‚úÖ –í—Å–µ API-–∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã, ERD, —Ñ–æ–Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏
- ‚úÖ –£—á—ë—Ç –ú–æ–ª–¥–æ–≤—ã (365 –¥–Ω–µ–π, —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞—Ç—ã)
- ‚úÖ –£–¥–∞–ª–µ–Ω–∏–µ –ø–µ–Ω–∏ –ø–æ –¶–ë –†–§
- ‚úÖ –°–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–µ —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞–º–∏ `/api/credits`
- ‚úÖ –ë–µ–∑ –¥—É–±–ª–µ–π, –Ω–æ **—Å –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–µ–π**

---

# üìÑ **–¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ ‚Ññ2 ‚Äî –ë–ª–æ–∫ ¬´–ë–∞–Ω–∫¬ª**  
## **(—Ñ–∏–Ω–∞–ª—å–Ω–∞—è, –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –ø–æ–¥—Ä–æ–±–Ω–∞—è –≤–µ—Ä—Å–∏—è v2.4 –¥–ª—è —Ä—ã–Ω–∫–∞ –ú–æ–ª–¥–æ–≤—ã)**

> **–°—Ç–∞—Ç—É—Å:** ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ  
> **–í–µ—Ä—Å–∏—è:** 2.4  
> **–î–∞—Ç–∞:** 05.04.2025  
> **–ê–≤—Ç–æ—Ä:** –ú–µ–Ω–µ–¥–∂–µ—Ä –ø—Ä–æ–µ–∫—Ç–∞ (20+ –ª–µ—Ç –æ–ø—ã—Ç–∞)  
> **–¶–µ–ª–µ–≤–∞—è –∞—É–¥–∏—Ç–æ—Ä–∏—è:** Backend-—Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∏ (NestJS), –∞—Ä—Ö–∏—Ç–µ–∫—Ç–æ—Ä—ã, QA, –∞–Ω–∞–ª–∏—Ç–∏–∫–∏, DevOps

---

## üéØ 1. –¶–µ–ª–∏ –º–æ–¥—É–ª—è

- –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ –≤–µ–¥–µ–Ω–∏–µ —É—á—ë—Ç–∞ –±–∞–Ω–∫–æ–≤—Å–∫–∏—Ö —Å—á–µ—Ç–æ–≤, **–∫—Ä–µ–¥–∏—Ç–æ–≤**, –ø–ª–∞—Ç–µ–∂–µ–π –∏ –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–æ–∫.
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á—ë—Ç**:
  - –ê–Ω–Ω—É–∏—Ç–µ—Ç–Ω—ã—Ö –∏ –¥–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–ª–∞—Ç–µ–∂–µ–π **–ø–æ –¥–Ω—è–º**
  - –ü—Ä–æ—Ü–µ–Ω—Ç–æ–≤ –ø—Ä–∏ **–ø–ª–∞–≤–∞—é—â–∏—Ö —Å—Ç–∞–≤–∫–∞—Ö** (—Å —Ä–∞–∑–±–∏–≤–∫–æ–π –ø–æ –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞–º)
  - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ **–æ—Ç—Å—Ä–æ—á–∫–∏ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –¥–æ–ª–≥–∞** –∫–∞–∫ –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–≥–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ (`defermentMonths`)
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ **—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞—Ç –ø–ª–∞—Ç–µ–∂–µ–π** (–Ω–∞–ø—Ä–∏–º–µ—Ä, 20-–µ —á–∏—Å–ª–æ –∫–∞–∂–¥–æ–≥–æ –º–µ—Å—è—Ü–∞).
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏ —Ä—É—á–Ω–æ–µ —Ä–∞—Å—á—ë—Ç–Ω–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ** –ø–ª–∞—Ç—ë–∂–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π.
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –≤–Ω–µ—à–Ω–∏–º–∏ –±–∞–Ω–∫–∞–º–∏ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ –≤—ã–ø–∏—Å–æ–∫.
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä—É—á–Ω–æ–≥–æ –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ **–ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –æ–ø–ª–∞—Ç—ã**.
- –û–±–µ—Å–ø–µ—á–µ–Ω–∏–µ –∞—É–¥–∏—Ç–∞ –∏ –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç–∏ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π.
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á—ë—Ç–æ–≤: –æ—Å—Ç–∞—Ç–∫–∏ –ø–æ —Å—á–µ—Ç–∞–º, –≥—Ä–∞—Ñ–∏–∫ –ø–æ–≥–∞—à–µ–Ω–∏—è, –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω–∞—è –∑–∞–¥–æ–ª–∂–µ–Ω–Ω–æ—Å—Ç—å.

---

## üèóÔ∏è 2. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ–µ –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ

- **–¢–∏–ø:** –ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å `bank-service`
- **–Ø–∑—ã–∫:** Node.js + NestJS
- **–ë–î:** PostgreSQL (—Å—Ö–µ–º–∞ `bank`)
- **–û—á–µ—Ä–µ–¥–∏:** RabbitMQ
- **–ö—ç—à:** Redis (–æ—Å—Ç–∞—Ç–∫–∏, –∞–≥—Ä–µ–≥–∞—Ç—ã)
- **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏:**
  - –í–Ω–µ—à–Ω–∏–µ –±–∞–Ω–∫–∏ ‚Üí –≤—ã–ø–∏—Å–∫–∏
  - –ú–æ–¥—É–ª—å ¬´–ö–∞—Å—Å–∞¬ª ‚Üí —Å–æ–±—ã—Ç–∏—è –æ –ø–æ—Å—Ç—É–ø–ª–µ–Ω–∏–∏
  - –ú–æ–¥—É–ª—å ¬´–û—Ç—á—ë—Ç—ã¬ª ‚Üí –∞–≥—Ä–µ–≥–∞—Ü–∏—è

> ‚úÖ –°–µ—Ä–≤–∏—Å stateless, –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º—ã–π, —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–≥–æ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è.

---

## üß© 3. –°—É—â–Ω–æ—Å—Ç–∏ –∏ ERD

### 3.1. –°—Ö–µ–º–∞ —Å—É—â–Ω–æ—Å—Ç–µ–π (–≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π DBML)
https://dbdiagram.io/d/TZ-%E2%84%962-%E2%80%94-Blok-%C2%ABBank%C2%BB-68d42701d2b621e422c39a82
```dbml
Table bank_account {
  id string [pk]
  name string
  account_number string
  bank_name string
  balance decimal
  created_at timestamp
  updated_at timestamp
}

Table credit {
  id string [pk]
  contract_number string
  bank_account_id string
  principal decimal
  initial_rate decimal
  start_date date
  end_date date
  remaining_principal decimal
  accrued_interest decimal
  deferment_months integer
  payment_day integer
  method string
  status string
  notes string
  created_at timestamp
  updated_at timestamp
}

Table credit_payment {
  id string [pk]
  credit_id string
  amount decimal
  principal_portion decimal
  interest_portion decimal
  payment_date date
  status string
  external_id string
  created_at timestamp
}

Table credit_rate_history {
  id string [pk]
  credit_id string
  rate decimal
  effective_from date
  notes string
  created_at timestamp
}
```

> ‚úÖ –í—Å–µ —Å—É–º–º—ã ‚Äî `DECIMAL(19,2)`.  
> ‚úÖ –ì–æ–¥ = **365 –¥–Ω–µ–π** (–≤–∏—Å–æ–∫–æ—Å–Ω—ã–µ ‚Äî –Ω–µ —É—á–∏—Ç—ã–≤–∞—é—Ç—Å—è, —Å–æ–≥–ª–∞—Å–Ω–æ –ø—Ä–∞–∫—Ç–∏–∫–µ –ú–æ–ª–¥–æ–≤—ã).  
> ‚úÖ –°—Ç–∞–≤–∫–∞ —Ö—Ä–∞–Ω–∏—Ç—Å—è **–≤ –ø—Ä–æ—Ü–µ–Ω—Ç–∞—Ö** (`9.9` = 9.9%).

---

## üìê 4. –ú–µ—Ç–æ–¥—ã —Ä–∞—Å—á—ë—Ç–∞ –∫—Ä–µ–¥–∏—Ç–æ–≤

### 4.1. Classic (–º–µ—Å—è—á–Ω—ã–π —Ä–∞—Å—á—ë—Ç)

- **–ê–Ω–Ω—É–∏—Ç–µ—Ç–Ω—ã–π**: —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–ª–∞—Ç—ë–∂ –Ω–∞ –≤–µ—Å—å —Å—Ä–æ–∫.
- **–î–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π**: —Ä–∞–≤–Ω—ã–µ –¥–æ–ª–∏ —Ç–µ–ª–∞, –ø—Ä–æ—Ü–µ–Ω—Ç—ã ‚Äî –ø–æ–º–µ—Å—è—á–Ω–æ.
- ‚ùå **–ù–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∞–≤–∫–∏**.
- ‚ùå **–ù–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –æ—Ç—Å—Ä–æ—á–∫—É**.

### 4.2. Floating Rates (—Ä–∞—Å—á—ë—Ç –ø–æ –¥–Ω—è–º)

#### –û–±—â–∏–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã:
- –ü—Ä–æ—Ü–µ–Ω—Ç—ã –Ω–∞—á–∏—Å–ª—è—é—Ç—Å—è **–µ–∂–µ–¥–Ω–µ–≤–Ω–æ** –Ω–∞ –æ—Å—Ç–∞—Ç–æ–∫ –¥–æ–ª–≥–∞.
- –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ç–∞–≤–∫–∏ ‚Äî –ø–µ—Ä–∏–æ–¥ —Ä–∞–∑–±–∏–≤–∞–µ—Ç—Å—è –Ω–∞ **–∏–Ω—Ç–µ—Ä–≤–∞–ª—ã**.
- –ü—Ä–æ—à–ª—ã–µ –ø–ª–∞—Ç–µ–∂–∏ **–Ω–µ –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞—é—Ç—Å—è**.

#### –§–æ—Ä–º—É–ª–∞ –¥–ª—è –æ–¥–Ω–æ–≥–æ –¥–Ω—è:
\[
\text{interest\_day} = \text{Principal} \cdot \frac{\text{Rate}}{100} \cdot \frac{1}{365}
\]

#### –ü—Ä–∏–º–µ—Ä –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞:
- –°—Ç–∞–≤–∫–∞ 9.9% —Å 21.03 –ø–æ 31.03 (11 –¥–Ω–µ–π)
- –°—Ç–∞–≤–∫–∞ 8.3% —Å 01.04 –ø–æ 20.04 (20 –¥–Ω–µ–π)
- –ü—Ä–æ—Ü–µ–Ω—Ç—ã = \( P \cdot \frac{9.9}{100} \cdot \frac{11}{365} + P \cdot \frac{8.3}{100} \cdot \frac{20}{365} \)

### 4.3. Floating Rates ‚Äî –ê–Ω–Ω—É–∏—Ç–µ—Ç

- –¶–µ–ª—å: **—Ä–∞–≤–Ω–æ–º–µ—Ä–Ω—ã–π –ø–ª–∞—Ç—ë–∂ –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö —Ç–µ–∫—É—â–µ–π —Å—Ç–∞–≤–∫–∏**.
- –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ç–∞–≤–∫–∏ ‚Äî **–ø–µ—Ä–µ—Å—á—ë—Ç –±—É–¥—É—â–∏—Ö –ø–ª–∞—Ç–µ–∂–µ–π**.
- –¢–µ–ª–æ –¥–æ–ª–≥–∞ = `—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–ª–∞—Ç—ë–∂ ‚Äì –ø—Ä–æ—Ü–µ–Ω—Ç—ã (–ø–æ –¥–Ω—è–º)`.

### 4.4. Floating Rates ‚Äî –î–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π

- –¢–µ–ª–æ –¥–æ–ª–≥–∞ = `Principal / —Å—Ä–æ–∫` ‚Äî **—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–æ**.
- –ü—Ä–æ—Ü–µ–Ω—Ç—ã = **–ø–æ –¥–Ω—è–º –Ω–∞ —É–º–µ–Ω—å—à–∞—é—â–∏–π—Å—è –æ—Å—Ç–∞—Ç–æ–∫**.
- –ü–ª–∞—Ç—ë–∂ = `—Ç–µ–ª–æ + –ø—Ä–æ—Ü–µ–Ω—Ç—ã` ‚Üí **—É–º–µ–Ω—å—à–∞–µ—Ç—Å—è**.
- –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ç–∞–≤–∫–∏ ‚Äî **–ø–µ—Ä–µ—Å—á—ë—Ç –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è**.

### 4.5. –û—Ç—Å—Ä–æ—á–∫–∞ (Grace Period)

- **–ü–∞—Ä–∞–º–µ—Ç—Ä:** `deferment_months` (0 ‚Äî –±–µ–∑ –æ—Ç—Å—Ä–æ—á–∫–∏, N ‚Äî —Å –æ—Ç—Å—Ä–æ—á–∫–æ–π)
- **–ü—Ä–∏–º–µ–Ω–∏–º–æ –∫:** `annuity_floating`, `differentiated_floating`
- **–ü–æ–≤–µ–¥–µ–Ω–∏–µ:**
  - –í –ª—å–≥–æ—Ç–Ω—ã–π –ø–µ—Ä–∏–æ–¥: **–ø–ª–∞—Ç—ë–∂ = —Ç–æ–ª—å–∫–æ –ø—Ä–æ—Ü–µ–Ω—Ç—ã**, —Ç–µ–ª–æ **–Ω–µ –≥–∞—Å–∏—Ç—Å—è**
  - –ü–æ—Å–ª–µ –æ—Ç—Å—Ä–æ—á–∫–∏: —Ä–∞—Å—á—ë—Ç –ø–æ –≤—ã–±—Ä–∞–Ω–Ω–æ–º—É –º–µ—Ç–æ–¥—É –Ω–∞ **–æ—Å—Ç–∞–≤—à–∏–π—Å—è —Å—Ä–æ–∫**
- **–ü—Ä–æ—Ü–µ–Ω—Ç—ã** –≤ –ø–µ—Ä–∏–æ–¥ –æ—Ç—Å—Ä–æ—á–∫–∏ ‚Äî **–ø–æ –¥–Ω—è–º**, —Å —É—á—ë—Ç–æ–º –∏—Å—Ç–æ—Ä–∏–∏ —Å—Ç–∞–≤–æ–∫

---

## üìä 5. –ü—Ä–∏–º–µ—Ä —Ä–∞—Å—á—ë—Ç–∞ (–≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π)

**–ö—Ä–µ–¥–∏—Ç:** 10 000 000 –ª–µ–µ–≤, —Å—Ä–æ–∫ 36 –º–µ—Å, –æ—Ç—Å—Ä–æ—á–∫–∞ 6 –º–µ—Å, —Å—Ç–∞–≤–∫–∞: 9.9% –¥–æ 01.04.2025, –¥–∞–ª–µ–µ 8.3%.  
**–î–∞—Ç–∞ –ø–ª–∞—Ç–µ–∂–∞:** 20-–µ —á–∏—Å–ª–æ.

- **–ú–∞—Ä—Ç 2025 (–ø–æ—Å–ª–µ–¥–Ω–∏–π –º–µ—Å—è—Ü –æ—Ç—Å—Ä–æ—á–∫–∏):**  
  –ü—Ä–æ—Ü–µ–Ω—Ç—ã = `10 000 000 √ó 9.9% / 365 √ó 31 ‚âà 84 082 –ª–µ—è`  
  –ü–ª–∞—Ç—ë–∂ = **84 082 –ª–µ—è** (—Ç–æ–ª—å–∫–æ –ø—Ä–æ—Ü–µ–Ω—Ç—ã)

- **–ê–ø—Ä–µ–ª—å 2025 (–ø–µ—Ä–≤—ã–π –ø–ª–∞—Ç—ë–∂ —Å –ø–æ–≥–∞—à–µ–Ω–∏–µ–º —Ç–µ–ª–∞):**  
  –¢–µ–ª–æ = `10 000 000 / 30 = 333 333.33 –ª–µ—è`  
  –ü—Ä–æ—Ü–µ–Ω—Ç—ã =  
  - 11 –¥–Ω–µ–π –ø–æ 9.9%: `10 000 000 √ó 9.9% / 365 √ó 11 ‚âà 29 863`  
  - 20 –¥–Ω–µ–π –ø–æ 8.3%: `10 000 000 √ó 8.3% / 365 √ó 20 ‚âà 45 479`  
  –ò—Ç–æ–≥–æ –ø—Ä–æ—Ü–µ–Ω—Ç—ã = **75 342 –ª–µ—è**  
  –ü–ª–∞—Ç—ë–∂ = `333 333.33 + 75 342 = 408 675.33 –ª–µ—è`

---

## üîÑ 6. –†–∞—Å—á—ë—Ç–Ω–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ –ø–ª–∞—Ç–µ–∂–µ–π

### 6.1. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ (–µ–∂–µ–¥–Ω–µ–≤–Ω–æ –≤ 08:00)

- –¢—Ä–∏–≥–≥–µ—Ä: `GenerateScheduledPaymentsJob`
- –ù–∞—Ö–æ–¥–∏—Ç –∫—Ä–µ–¥–∏—Ç—ã —Å `payment_date = —Å–µ–≥–æ–¥–Ω—è`
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—ë—Ç –∑–∞–ø–∏—Å—å –≤ `credit_payment`** —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º **`scheduled`**
- **–ë–µ–∑ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è**, –±–µ–∑ —É—á–∞—Å—Ç–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –î–∞—Ç–∞ –ø–ª–∞—Ç–µ–∂–∞ = **—Ç–æ—á–Ω–∞—è –¥–∞—Ç–∞ –∏–∑ –≥—Ä–∞—Ñ–∏–∫–∞** (–Ω–∞–ø—Ä–∏–º–µ—Ä, `2025-04-20`)

### 6.2. –†—É—á–Ω–æ–µ (–∫–Ω–æ–ø–∫–∞ ¬´–†–∞—Å—Å—á–∏—Ç–∞—Ç—å¬ª –≤ UI)

- –û—Ç–∫—Ä—ã–≤–∞–µ—Ç —Ç–∞–±–ª–∏—Ü—É —Å–æ **–≤—Å–µ–º–∏ –Ω–µ–ø—Ä–æ–≤–µ–¥—ë–Ω–Ω—ã–º–∏ –ø–ª–∞—Ç—ë–∂–Ω—ã–º–∏ –ø–µ—Ä–∏–æ–¥–∞–º–∏** (–≤–∫–ª—é—á–∞—è –ø—Ä–æ—à–ª—ã–µ)
- –°—Ç–æ–ª–±—Ü—ã: –¥–∞—Ç–∞, —Ç–µ–ª–æ, –ø—Ä–æ—Ü–µ–Ω—Ç—ã, –∏—Ç–æ–≥–æ, —Å—Ç–∞—Ç—É—Å (`–û–∂–∏–¥–∞–µ—Ç—Å—è` / `–ü—Ä–æ—Å—Ä–æ—á–µ–Ω`)
- **–ß–µ–∫–±–æ–∫—Å—ã** –¥–ª—è –≤—ã–±–æ—Ä–∞ –æ–¥–Ω–æ–≥–æ –∏–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –ø–µ—Ä–∏–æ–¥–æ–≤
- –ö–Ω–æ–ø–∫–∞ **¬´–°–æ–∑–¥–∞—Ç—å –ø–ª–∞—Ç–µ–∂–∏¬ª**:
  - –°–æ–∑–¥–∞—ë—Ç –∑–∞–ø–∏—Å–∏ –≤ `credit_payment` —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º **`scheduled`**
  - –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç `payment_date` **—Å—Ç—Ä–æ–≥–æ –ø–æ –¥–∞—Ç–µ –∏–∑ —Ç–∞–±–ª–∏—Ü—ã** (`2025-03-20`, `2025-02-20` –∏ —Ç.–¥.)
  - **–ë–µ–∑ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è**
  - –ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å: –¥—É–±–ª–∏ –Ω–µ —Å–æ–∑–¥–∞—é—Ç—Å—è
–ö—Ä–∞—Ç–∫–æ: —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –†–∞—Å—á–µ—Ç–Ω–æ–≥–æ –∑–∞–∫—Ä—ã—Ç–∏—è –ø–ª–∞—Ç–µ–∂–µ–π —Ä–µ–∞–ª–∏–∑—É–µ—Ç –ø—É–Ω–∫—Ç 6.2 –¢–ó ‚Äî ¬´–†—É—á–Ω–æ–µ (–∫–Ω–æ–ø–∫–∞ ‚Äú–†–∞—Å—Å—á–∏—Ç–∞—Ç—å‚Äù –≤ UI)¬ª —Ç–∞–∫, –∫–∞–∫ –æ–ø–∏—Å–∞–Ω–æ –≤ –¥–æ–∫—É–º–µ–Ω—Ç–µ. –ù–∏–∂–µ ‚Äî —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –∫–∞–∂–¥–æ–≥–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∏ –ø–æ—à–∞–≥–æ–≤–∞—è –ª–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã. –§–∞–π–ª —Å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–µ–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞: `ManualPaymentCalculation.tsx` –°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è: `–¢–ó ‚Ññ2 ‚Äî –ë–ª–æ–∫ ¬´–ë–∞–Ω–∫¬ª.md` –°–µ—Ä–≤–µ—Ä–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã: `server.js` –∏ –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–π API-—Ä–µ—Ñ–µ—Ä–µ–Ω—Å `payment-api.js` –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º –¢–ó (—Å—Ç—Ä–æ–∫–∏ 199‚Äì208): - ¬´–û—Ç–∫—Ä—ã–≤–∞–µ—Ç —Ç–∞–±–ª–∏—Ü—É —Å–æ –≤—Å–µ–º–∏ –Ω–µ–ø—Ä–æ–≤–µ–¥—ë–Ω–Ω—ã–º–∏ –ø–ª–∞—Ç—ë–∂–Ω—ã–º–∏ –ø–µ—Ä–∏–æ–¥–∞–º–∏ (–≤–∫–ª—é—á–∞—è –ø—Ä–æ—à–ª—ã–µ)¬ª - –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –≤—ã–∑—ã–≤–∞–µ—Ç GET /api/credits/:id –∏ GET /api/credits/:id/payments/unprocessed. –í—Å–µ –Ω–µ–ø—Ä–æ–≤–µ–¥–µ–Ω–Ω—ã–µ –ø–µ—Ä–∏–æ–¥—ã –æ—Ç–¥–∞—é—Ç—Å—è —Å–µ—Ä–≤–µ—Ä–æ–º, –∞ –≤ UI –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è, –∫–∞–∫–∏–µ –∏–∑ –Ω–∏—Ö —É–∂–µ –ø—Ä–æ—Å—Ä–æ—á–µ–Ω—ã, ‚Äî —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ–º dueDate —Å —Å–µ–≥–æ–¥–Ω—è—à–Ω–∏–º –¥–Ω—ë–º. –≠—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏ —Ç–µ–∫—É—â–∏—Ö, –∏ –ø—Ä–æ—à–µ–¥—à–∏—Ö (–ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã—Ö) –ø–µ—Ä–∏–æ–¥–æ–≤. –°–º. —Ñ—É–Ω–∫—Ü–∏—é loadCreditData –∏ –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ getStatusByDate –≤ `ManualPaymentCalculation.tsx` . - ¬´–°—Ç–æ–ª–±—Ü—ã: –¥–∞—Ç–∞, —Ç–µ–ª–æ, –ø—Ä–æ—Ü–µ–Ω—Ç—ã, –∏—Ç–æ–≥–æ, —Å—Ç–∞—Ç—É—Å (–û–∂–∏–¥–∞–µ—Ç—Å—è / –ü—Ä–æ—Å—Ä–æ—á–µ–Ω)¬ª - –¢–∞–±–ª–∏—Ü–∞ —Ä–µ–Ω–¥–µ—Ä–∏—Ç: –ü–µ—Ä–∏–æ–¥ (periodNumber), –î–∞—Ç–∞ –ø–ª–∞—Ç–µ–∂–∞ (dueDate), –û—Å–Ω–æ–≤–Ω–æ–π –¥–æ–ª–≥ (principalDue), –ü—Ä–æ—Ü–µ–Ω—Ç—ã (interestDue), –û–±—â–∏–π –ø–ª–∞—Ç–µ–∂ (totalDue), –°—Ç–∞—Ç—É—Å. –î–ª—è —Å—Ç–∞—Ç—É—Å–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –±–µ–π–¥–∂: ‚Äò–û–∂–∏–¥–∞–µ—Ç—Å—è‚Äô –¥–ª—è –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö, ‚Äò–ü—Ä–æ—Å—Ä–æ—á–µ–Ω‚Äô –¥–ª—è –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã—Ö. –°–º. —Å–µ–∫—Ü–∏—é —Å TableHeader/TableBody –∏ getStatusBadgeVariant –≤ `ManualPaymentCalculation.tsx` . - ¬´–ß–µ–∫–±–æ–∫—Å—ã –¥–ª—è –≤—ã–±–æ—Ä–∞ –æ–¥–Ω–æ–≥–æ –∏–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –ø–µ—Ä–∏–æ–¥–æ–≤¬ª - –í –∫–∞–∂–¥–æ–π —Å—Ç—Ä–æ–∫–µ –µ—Å—Ç—å Checkbox –¥–ª—è –≤—ã–±–æ—Ä–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø–µ—Ä–∏–æ–¥–∞, –ø–ª—é—Å —á–µ–∫–±–æ–∫—Å/–∫–Ω–æ–ø–∫–∞ ¬´–í—ã–±—Ä–∞—Ç—å –≤—Å–µ¬ª –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ –∫–∞—Ä—Ç–æ—á–∫–∏. –°–æ—Å—Ç–æ—è–Ω–∏–µ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –ø–µ—Ä–∏–æ–¥–æ–≤ —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ selectedPeriods (–º–Ω–æ–∂–µ—Å—Ç–≤–æ –ø–µ—Ä–∏–æ–¥–æ–≤). –°–º. handlePeriodSelection –∏ handleSelectAll –≤ `ManualPaymentCalculation.tsx` . - ¬´–ö–Ω–æ–ø–∫–∞ ‚Äú–°–æ–∑–¥–∞—Ç—å –ø–ª–∞—Ç–µ–∂–∏‚Äù: —Å–æ–∑–¥–∞—ë—Ç –∑–∞–ø–∏—Å–∏ –≤ credit_payment —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º scheduled¬ª - –ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –∫–Ω–æ–ø–∫–∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è handleCreatePayments: —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è payload –∏–∑ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –ø–µ—Ä–∏–æ–¥–æ–≤ –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è POST /api/credits/:id/payments/bulk —Å –ø–æ–ª—è–º–∏ periodNumber, dueDate, principalDue, interestDue, totalDue. –ù–∞ –±—ç–∫–µ–Ω–¥–µ —Å–æ–∑–¥–∞—é—Ç—Å—è –∑–∞–ø–∏—Å–∏ –≤ —Ç–∞–±–ª–∏—Ü–µ credit_payment —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º scheduled. –°–º. handleCreatePayments –≤ `ManualPaymentCalculation.tsx` –∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é bulk-—ç–Ω–¥–ø–æ–∏–Ω—Ç–∞ –≤ `server.js` / `payment-api.js` . - ¬´–£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç payment_date —Å—Ç—Ä–æ–≥–æ –ø–æ –¥–∞—Ç–µ –∏–∑ —Ç–∞–±–ª–∏—Ü—ã¬ª - –í payload —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ –ø–µ—Ä–µ–¥–∞—ë—Ç dueDate. –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ —ç—Ç–∞ –¥–∞—Ç–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–∞–∫ –¥–∞—Ç–∞ –ø–ª–∞—Ç–µ–∂–∞ (payment_date) –ø—Ä–∏ –≤—Å—Ç–∞–≤–∫–µ –≤ credit_payment. –ë–ª–∞–≥–æ–¥–∞—Ä—è —ç—Ç–æ–º—É –¥–∞—Ç–∞ –≤ —Ç–∞–±–ª–∏—Ü–µ –∏ –¥–∞—Ç–∞ –∑–∞–ø–∏—Å–∏ —Å–æ–≤–ø–∞–¥–∞—é—Ç —Å—Ç—Ä–æ–≥–æ. –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –Ω–æ—Ä–º–∞–ª–∏–∑—É–µ—Ç naming (dueDate/due_date) –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ. - ¬´–ë–µ–∑ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è¬ª - –ü–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞ –ø–µ—Ä–∏–æ–¥–æ–≤ –∫–Ω–æ–ø–∫–∞ —Å—Ä–∞–∑—É –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–ø—Ä–æ—Å, –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω –∏–ª–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–π –Ω–µ—Ç. - ¬´–ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å: –¥—É–±–ª–∏ –Ω–µ —Å–æ–∑–¥–∞—é—Ç—Å—è¬ª - –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –∑–∞—â–∏—Ç–∞ –æ—Ç –¥—É–±–ª–µ–π: –≤—Å—Ç–∞–≤–∫–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏ (–æ–±—ã—á–Ω–æ –ø–æ –∫–ª—é—á—É credit_id + period_number, –ª–∏–±–æ —á–µ—Ä–µ–∑ ON CONFLICT DO NOTHING), —á—Ç–æ–±—ã –ø–æ–≤—Ç–æ—Ä–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ —Ç–æ–≥–æ –∂–µ –ø–µ—Ä–∏–æ–¥–∞ –Ω–µ —Å–æ–∑–¥–∞–≤–∞–ª–∞ –≤—Ç–æ—Ä—É—é –∑–∞–ø–∏—Å—å. –≠—Ç–æ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –æ–ø–∏—Å–∞–Ω–æ –∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –≤ —Å–µ—Ä–≤–µ—Ä–Ω–æ–π —á–∞—Å—Ç–∏, —Å–º. bulk-—ç–Ω–¥–ø–æ–∏–Ω—Ç –≤ `server.js` / `payment-api.js` . –ü–æ—à–∞–≥–æ–≤–∞—è –ª–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã UI: 1. 1. –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö: - –ü–æ –º–∞—Ä—à—Ä—É—Ç—É /credits/:id/manual-calculation –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –ø–æ–ª—É—á–∞–µ—Ç id –∏–∑ URL. - –í—ã–∑—ã–≤–∞–µ—Ç /api/credits/:id –¥–ª—è –∑–∞–≥–æ–ª–æ–≤–∫–∞ (–Ω–æ–º–µ—Ä –¥–æ–≥–æ–≤–æ—Ä–∞, –º–µ—Ç–æ–¥) –∏ /api/credits/:id/payments/unprocessed –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã –ø–µ—Ä–∏–æ–¥–æ–≤. –°–º. useEffect –∏ loadCreditData –≤ `ManualPaymentCalculation.tsx` . 2. 2. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Å—Ç–∞—Ç—É—Å–∞: - –î–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–µ—Ä–∏–æ–¥–∞ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è —Å—Ç–∞—Ç—É—Å: –µ—Å–ª–∏ dueDate < —Å–µ–≥–æ–¥–Ω—è ‚Äî ‚Äò–ü—Ä–æ—Å—Ä–æ—á–µ–Ω‚Äô, –∏–Ω–∞—á–µ ‚Äò–û–∂–∏–¥–∞–µ—Ç—Å—è‚Äô. –°–º. getStatusByDate. 3. 3. –í—ã–±–æ—Ä –ø–µ—Ä–∏–æ–¥–æ–≤: - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–º–µ—á–∞–µ—Ç —á–µ–∫–±–æ–∫—Å—ã –≤ —Å—Ç—Ä–æ–∫–∞—Ö –∏–ª–∏ –Ω–∞–∂–∏–º–∞–µ—Ç ¬´–í—ã–±—Ä–∞—Ç—å –≤—Å–µ¬ª. –°–º. selectedPeriods –∏ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏. 4. 4. –°–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–µ–π: - –ù–∞–∂–∞—Ç–∏–µ ¬´–°–æ–∑–¥–∞—Ç—å –ø–ª–∞—Ç–µ–∂–∏¬ª –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç POST /api/credits/:id/payments/bulk —Å –≤—ã–±—Ä–∞–Ω–Ω—ã–º–∏ –ø–µ—Ä–∏–æ–¥–∞–º–∏, –±–µ–∑ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è. - –°–µ—Ä–≤–µ—Ä —Å–æ–∑–¥–∞—ë—Ç –∑–∞–ø–∏—Å–∏ –≤ credit_payment —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º scheduled –∏ payment_date = dueDate –∏–∑ —Ç–∞–±–ª–∏—Ü—ã, —Å –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å—é. - –ü–æ—Å–ª–µ —É—Å–ø–µ—Ö–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ, –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –Ω–µ–ø—Ä–æ–≤–µ–¥–µ–Ω–Ω—ã—Ö –ø–µ—Ä–∏–æ–¥–æ–≤ –∏ —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç –≤—ã–±–æ—Ä. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ: - –ö–∞—Ä—Ç–æ—á–∫–∏-—Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–≤–µ—Ä—Ö—É –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–µ–ø—Ä–æ–≤–µ–¥—ë–Ω–Ω—ã—Ö, —Å–∫–æ–ª—å–∫–æ –∏–∑ –Ω–∏—Ö –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–æ (—Å—á–∏—Ç–∞–µ—Ç—Å—è –ø–æ isOverdue), –∏ —Å–∫–æ–ª—å–∫–æ –≤—ã–±—Ä–∞–Ω–æ. - –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫/–∑–∞–≥—Ä—É–∑–∫–∏: –µ—Å—Ç—å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –∏ –∞–ª–µ—Ä—Ç—ã –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö, —Å–º. isLoading, isCalculating, error/successMessage. –ï—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ, –º–æ–≥—É: - –ø–æ–∫–∞–∑–∞—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏ —Å–µ—Ä–≤–µ—Ä–Ω–æ–≥–æ –∫–æ–¥–∞, –≥–¥–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è upsert/–ø—Ä–æ–≤–µ—Ä–∫–∞ –¥—É–±–ª–µ–π –ø–æ period_number; - –¥–æ–±–∞–≤–∏—Ç—å –≤–∏–∑—É–∞–ª—å–Ω—ã–π –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ –∫–Ω–æ–ø–∫—É –¥–ª—è –ª—É—á—à–µ–≥–æ UX –∏–ª–∏ —Ñ–∏–ª—å—Ç—Ä –ø–æ —Å—Ç–∞—Ç—É—Å—É/–¥–∞—Ç–µ; - —Ä–∞—Å—à–∏—Ä–∏—Ç—å –∫–æ–ª–æ–Ω–∫—É ¬´–°—Ç–∞—Ç—É—Å¬ª (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –Ω–µ —Ç–æ–ª—å–∫–æ –æ–∂–∏–¥–∞–µ—Ç—Å—è/–ø—Ä–æ—Å—Ä–æ—á–µ–Ω, –Ω–æ –∏ –¥—Ä—É–≥–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è, –µ—Å–ª–∏ –æ–Ω–∏ –ø–æ—è–≤—è—Ç—Å—è –≤ –¥–∞–Ω–Ω—ã—Ö).
---

## üñ•Ô∏è 7. UI-—Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è

### 7.1. –°–æ–∑–¥–∞–Ω–∏–µ –∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫—Ä–µ–¥–∏—Ç–∞

#### –°–µ–∫—Ü–∏–∏ —Ñ–æ—Ä–º—ã:
1. **–û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è**: –Ω–æ–º–µ—Ä –¥–æ–≥–æ–≤–æ—Ä–∞, —Å—É–º–º–∞, –±–∞–Ω–∫, –≤–∞–ª—é—Ç–∞.
2. **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Ä–∞—Å—á—ë—Ç–∞**: –º–µ—Ç–æ–¥, –¥–µ–Ω—å –ø–ª–∞—Ç–µ–∂–∞, –¥–∞—Ç–∞ –Ω–∞—á–∞–ª–∞, —Å—Ä–æ–∫, –æ—Ç—Å—Ä–æ—á–∫–∞.
3. **–ò—Å—Ç–æ—Ä–∏—è —Å—Ç–∞–≤–æ–∫** (–¥–ª—è –ø–ª–∞–≤–∞—é—â–∏—Ö –º–µ—Ç–æ–¥–æ–≤): —Ç–∞–±–ª–∏—Ü–∞ —Å –¥–∞—Ç–æ–π –∏ —Å—Ç–∞–≤–∫–æ–π.
4. **–ü—Ä–∏–º–µ—á–∞–Ω–∏—è**: —Ç–µ–∫—Å—Ç–æ–≤–æ–µ –ø–æ–ª–µ.

#### –î–µ–π—Å—Ç–≤–∏—è:
- **–ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π —Ä–∞—Å—á—ë—Ç** ‚Üí –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å –≥—Ä–∞—Ñ–∏–∫–æ–º.
- **–°–æ–∑–¥–∞—Ç—å –∫—Ä–µ–¥–∏—Ç** ‚Üí –æ—Ç–ø—Ä–∞–≤–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä.
- **–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** ‚Üí —Ç–æ–ª—å–∫–æ –¥–ª—è –∞–∫—Ç–∏–≤–Ω—ã—Ö –∫—Ä–µ–¥–∏—Ç–æ–≤, –±–µ–∑ –ø—Ä–æ–≤–µ–¥—ë–Ω–Ω—ã—Ö –ø–ª–∞—Ç–µ–∂–µ–π.

---

### 7.2. –°–ø–∏—Å–æ–∫ –∫—Ä–µ–¥–∏—Ç–æ–≤

#### –¢–∞–±–ª–∏—Ü–∞:
- –ö–æ–ª–æ–Ω–∫–∏: –î–æ–≥–æ–≤–æ—Ä, –ë–∞–Ω–∫, –°—É–º–º–∞, –ú–µ—Ç–æ–¥, –î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞, –°—Ä–æ–∫, –°—Ç–∞—Ç—É—Å, –î–µ–π—Å—Ç–≤–∏—è.
- –î–µ–π—Å—Ç–≤–∏—è: üëÅÔ∏è –ü—Ä–æ—Å–º–æ—Ç—Ä, üìä –ì—Ä–∞—Ñ–∏–∫, ‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å, üóëÔ∏è –£–¥–∞–ª–∏—Ç—å.
- –§–∏–ª—å—Ç—Ä—ã: –í—Å–µ, –ê–∫—Ç–∏–≤–Ω—ã–µ, –ü—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã–µ.
- –ü–æ–∏—Å–∫ –ø–æ –Ω–æ–º–µ—Ä—É –¥–æ–≥–æ–≤–æ—Ä–∞.

#### –§—É—Ç–µ—Ä:
- –û–±—â–∞—è —Å—É–º–º–∞ –∫—Ä–µ–¥–∏—Ç–æ–≤
- –°—Ä–µ–¥–Ω–∏–π —Ä–∞–∑–º–µ—Ä –∫—Ä–µ–¥–∏—Ç–∞
- –°—Ä–µ–¥–Ω–∏–π —Å—Ä–æ–∫

---

### 7.3. –ì—Ä–∞—Ñ–∏–∫ –ø–ª–∞—Ç–µ–∂–µ–π

#### –¢–∞–±–ª–∏—Ü–∞:
- –ö–æ–ª–æ–Ω–∫–∏: –ú–µ—Å—è—Ü, –ü–ª–∞—Ç—ë–∂, –û—Å–Ω–æ–≤–Ω–æ–π –¥–æ–ª–≥, –ü—Ä–æ—Ü–µ–Ω—Ç—ã, –û—Å—Ç–∞—Ç–æ–∫, **–ü—Ä–æ—Ü–µ–Ω—Ç–Ω–∞—è —Å—Ç–∞–≤–∫–∞ (%)**
- –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç **—Å—Ä–µ–¥–Ω—é—é —Å—Ç–∞–≤–∫—É –∑–∞ –º–µ—Å—è—Ü** (—Å —É—á—ë—Ç–æ–º –≤—Å–µ—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ —Ç–µ—á–µ–Ω–∏–µ –º–µ—Å—è—Ü–∞).

#### –§—É—Ç–µ—Ä:
- –û–±—â–∞—è —Å—É–º–º–∞ –ø–ª–∞—Ç–µ–∂–µ–π
- –û–±—â–∏–µ –ø—Ä–æ—Ü–µ–Ω—Ç—ã
- –ü–µ—Ä–µ–ø–ª–∞—Ç–∞

---

## üåê 8. API-–∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã (—Ä–µ–∞–ª—å–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã)

### 8.1. –°–æ–∑–¥–∞–Ω–∏–µ –∫—Ä–µ–¥–∏—Ç–∞

```yaml
POST /api/credits
Body:
  type: "annuity_floating"
  defermentMonths: 6
  paymentDay: 20
  initialRate: 9.9
  rateHistory:
    - { rate: 9.9, effectiveFrom: "2025-01-01", notes: "–ë–∞–∑–æ–≤–∞—è —Å—Ç–∞–≤–∫–∞" }
    - { rate: 8.3, effectiveFrom: "2025-04-01", notes: "–°–Ω–∏–∂–µ–Ω–∏–µ —Å—Ç–∞–≤–∫–∏" }
```

### 8.2. –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –∫—Ä–µ–¥–∏—Ç–æ–≤

```yaml
GET /api/credits?search=CR-2025&status=active
```

### 8.3. –ü–æ–ª—É—á–µ–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–∞ –ø–ª–∞—Ç–µ–∂–µ–π

```yaml
GET /api/credits/{id}/schedule
```

### 8.4. –†—É—á–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞—Ç—ë–∂–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π

```yaml
POST /api/credits/{id}/create-payments
Body:
  paymentDates: ["2025-03-20", "2025-02-20"]
```

### 8.5. Preview —Ä–∞—Å—á—ë—Ç–∞

```yaml
GET /api/credits/{id}/preview-payments
‚Üí –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–∞—Å—á—ë—Ç –ø–æ –≤—Å–µ–º –Ω–µ–ø—Ä–æ–≤–µ–¥—ë–Ω–Ω—ã–º –ø–µ—Ä–∏–æ–¥–∞–º
```

---

## üîÑ 9. –§–æ–Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏

| –ó–∞–¥–∞—á–∞ | –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
|--------|------------|----------|
| `GenerateScheduledPaymentsJob` | –ï–∂–µ–¥–Ω–µ–≤–Ω–æ –≤ **08:00** | –°–æ–∑–¥–∞—ë—Ç –ø–ª–∞—Ç—ë–∂–Ω—ã–µ –∑–∞–ø–∏—Å–∏ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è |
| `MarkOverduePaymentsJob` | –ï–∂–µ–¥–Ω–µ–≤–Ω–æ –≤ **00:01** | –ú–µ–Ω—è–µ—Ç —Å—Ç–∞—Ç—É—Å `scheduled` ‚Üí `overdue` |

---

## üõ†Ô∏è 10. –°–∫—Ä–∏–ø—Ç—ã –º–∏–≥—Ä–∞—Ü–∏–∏ (–≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ)

```sql
CREATE TABLE credit (
  id VARCHAR PRIMARY KEY,
  contract_number VARCHAR NOT NULL,
  bank_account_id VARCHAR NOT NULL,
  principal DECIMAL(19,2) NOT NULL,
  initial_rate DECIMAL(5,2),
  start_date DATE,
  end_date DATE,
  remaining_principal DECIMAL(19,2),
  accrued_interest DECIMAL(19,2),
  deferment_months INTEGER DEFAULT 0,
  payment_day INTEGER NOT NULL,
  method VARCHAR NOT NULL,
  status VARCHAR DEFAULT 'active',
  notes TEXT
);

CREATE TABLE credit_rate_history (
  id VARCHAR PRIMARY KEY,
  credit_id VARCHAR NOT NULL REFERENCES credit(id),
  rate DECIMAL(5,2) NOT NULL,
  effective_from DATE NOT NULL,
  notes TEXT
);

CREATE TABLE credit_payment (
  id VARCHAR PRIMARY KEY,
  credit_id VARCHAR NOT NULL REFERENCES credit(id),
  amount DECIMAL(19,2) NOT NULL,
  principal_portion DECIMAL(19,2),
  interest_portion DECIMAL(19,2),
  payment_date DATE NOT NULL,
  status VARCHAR DEFAULT 'scheduled',
  external_id VARCHAR
);
```

---

## ‚úÖ 11. –ö—Ä–∏—Ç–µ—Ä–∏–∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ (DoD)

- [ ] –ü–æ–¥–¥–µ—Ä–∂–∫–∞ **2 –±–∞–∑–æ–≤—ã—Ö –º–µ—Ç–æ–¥–æ–≤** (`Classic`, `Floating`) —Å –ø–æ–¥–º–µ—Ç–æ–¥–∞–º–∏
- [ ] **–û—Ç—Å—Ä–æ—á–∫–∞** –∫–∞–∫ –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä (`defermentMonths`)
- [ ] **–§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞—Ç—ã –ø–ª–∞—Ç–µ–∂–µ–π** (`paymentDay`)
- [ ] **–†–∞—Å—á—ë—Ç –ø–æ –¥–Ω—è–º**, –≥–æ–¥ = 365 –¥–Ω–µ–π
- [ ] **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ** –ø–ª–∞—Ç—ë–∂–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π –≤ 08:00 **–±–µ–∑ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è**
- [ ] **–†—É—á–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ** –ø–ª–∞—Ç—ë–∂–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π –Ω–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –¥–∞—Ç—ã (–≤–∫–ª—é—á–∞—è –ø—Ä–æ—à–ª—ã–µ)
- [ ] –í—Å–µ –ø–ª–∞—Ç–µ–∂–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è —Å **—Ç–æ—á–Ω–æ–π –¥–∞—Ç–æ–π** (20.XX.XXXX)
- [ ] –ü–æ–¥–¥–µ—Ä–∂–∫–∞ **–∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏** ‚Äî –¥—É–±–ª–∏ –Ω–µ —Å–æ–∑–¥–∞—é—Ç—Å—è
- [ ] UI –ø–æ–∑–≤–æ–ª—è–µ—Ç –≤—ã–±—Ä–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø–µ—Ä–∏–æ–¥–æ–≤ –∏ —Å–æ–∑–¥–∞—Ç—å –∏—Ö –æ–¥–Ω–∏–º –∫–ª–∏–∫–æ–º
- [ ] –í—Å–µ —Ñ–æ—Ä–º—É–ª—ã –ø–æ–∫—Ä—ã—Ç—ã unit-—Ç–µ—Å—Ç–∞–º–∏ (100%)

---

> ‚úÖ **–¢–ó ‚Ññ2 ‚Äî –ë–ª–æ–∫ ¬´–ë–∞–Ω–∫¬ª ‚Äî —Ñ–∏–Ω–∞–ª—å–Ω–∞—è, –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –ø–æ–¥—Ä–æ–±–Ω–∞—è –≤–µ—Ä—Å–∏—è –¥–ª—è —Ä—ã–Ω–∫–∞ –ú–æ–ª–¥–æ–≤—ã ‚Äî –≥–æ—Ç–æ–≤–æ –∫ –ø–µ—Ä–µ–¥–∞—á–µ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫—É.**  
> –í—Å–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∏–∑ –∫–æ–¥–∞, –º–∞–∫–µ—Ç–æ–≤ –∏ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ —É—á—Ç–µ–Ω—ã. –í–Ω–µ—à–Ω–∏—Ö —Å—Å—ã–ª–æ–∫ –Ω–µ—Ç.

--- 

–ì–æ—Ç–æ–≤ –∫ –ø–µ—Ä–µ–¥–∞—á–µ –≤ –∫–æ–º–∞–Ω–¥—É —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏.