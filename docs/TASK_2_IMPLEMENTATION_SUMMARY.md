# –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–¥–∞—á–∏ 2: –£–ª—É—á—à–µ–Ω–∏—è API –¥–ª—è –ø—Ä–æ–≥–Ω–æ–∑–Ω–æ–≥–æ –æ—Ç—á–µ—Ç–∞

## –û–±–∑–æ—Ä –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω–æ–π —Ä–∞–±–æ—Ç—ã

–£—Å–ø–µ—à–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ **–ó–∞–¥–∞—á–∞ 2: Implement backend API enhancements for forecast report** —Å–æ –≤—Å–µ–º–∏ –ø–æ–¥–∑–∞–¥–∞—á–∞–º–∏.

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –ø–æ–¥–∑–∞–¥–∞—á–∏

### 2.1 –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞ `/api/reports/forecast` –¥–ª—è –ø—Ä–∏–Ω—è—Ç–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏

**–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:**
- ‚úÖ –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ `dateFrom`, `dateTo` –∏ `bankId` –∏–∑ query string
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —É—Å–ª–æ–≤–∏–π WHERE –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –∫—Ä–µ–¥–∏—Ç–æ–≤ –ø–æ `start_date >= dateFrom`
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —É—Å–ª–æ–≤–∏–π WHERE –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –∫—Ä–µ–¥–∏—Ç–æ–≤ –ø–æ `start_date <= dateTo`
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —É—Å–ª–æ–≤–∏–π WHERE –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –∫—Ä–µ–¥–∏—Ç–æ–≤ –ø–æ `bank_id = bankId` –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏

### 2.2 –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–æ–≤ –ø–µ—Ä–µ–¥ –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π –≥—Ä–∞—Ñ–∏–∫–æ–≤ –ø–ª–∞—Ç–µ–∂–µ–π

**–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:**
- ‚úÖ –ú–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–∞ –≤—ã–±–æ—Ä–∫–∏ –∫—Ä–µ–¥–∏—Ç–æ–≤ –¥–ª—è –≤–∫–ª—é—á–µ–Ω–∏—è —É—Å–ª–æ–≤–∏–π —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
- ‚úÖ –û–±–µ—Å–ø–µ—á–µ–Ω–∏–µ –ø–æ–ª—É—á–µ–Ω–∏—è ScheduleEngine —Ç–æ–ª—å–∫–æ –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∫—Ä–µ–¥–∏—Ç–æ–≤

### 2.3 –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫ –¥–ª—è –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏

**–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:**
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–æ—Ä–º–∞—Ç–∞ –¥–∞—Ç (ISO 8601: YYYY-MM-DD)
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–æ—Ä–º–∞—Ç–∞ bankId (UUID –∏–ª–∏ "all")
- ‚úÖ –í–æ–∑–≤—Ä–∞—Ç —Å—Ç–∞—Ç—É—Å–∞ 400 —Å —Å–æ–æ–±—â–µ–Ω–∏–µ–º –æ–± –æ—à–∏–±–∫–µ –¥–ª—è –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã—Ö –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### 1. –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
```javascript
const { dateFrom, dateTo, bankId } = req.query;
```

### 2. –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
```javascript
// –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –¥–ª—è –ø—Ä–æ–≥–Ω–æ–∑–Ω–æ–≥–æ –æ—Ç—á–µ—Ç–∞
// –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ñ–æ—Ä–º–∞—Ç –¥–∞—Ç—ã "–æ—Ç" (–¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –≤ —Ñ–æ—Ä–º–∞—Ç–µ ISO 8601: YYYY-MM-DD)
if (dateFrom && !/^\d{4}-\d{2}-\d{2}$/.test(dateFrom)) {
  return res.status(400).json({ 
    error: '–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç dateFrom. –û–∂–∏–¥–∞–µ—Ç—Å—è —Ñ–æ—Ä–º–∞—Ç ISO 8601 (YYYY-MM-DD)' 
  });
}

// –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ñ–æ—Ä–º–∞—Ç –¥–∞—Ç—ã "–¥–æ" (–¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –≤ —Ñ–æ—Ä–º–∞—Ç–µ ISO 8601: YYYY-MM-DD)
if (dateTo && !/^\d{4}-\d{2}-\d{2}$/.test(dateTo)) {
  return res.status(400).json({ 
    error: '–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç dateTo. –û–∂–∏–¥–∞–µ—Ç—Å—è —Ñ–æ—Ä–º–∞—Ç ISO 8601 (YYYY-MM-DD)' 
  });
}

// –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ñ–æ—Ä–º–∞—Ç ID –±–∞–Ω–∫–∞ (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å UUID –∏–ª–∏ "all")
if (bankId && bankId !== 'all' && !/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(bankId)) {
  return res.status(400).json({ 
    error: '–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç bankId. –û–∂–∏–¥–∞–µ—Ç—Å—è UUID —Ñ–æ—Ä–º–∞—Ç –∏–ª–∏ "all"' 
  });
}
```

### 3. –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–∞
```javascript
// –î–æ–±–∞–≤–ª—è–µ–º —É—Å–ª–æ–≤–∏—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –ø–æ –¥–∞—Ç–∞–º –∏ –±–∞–Ω–∫—É
if (dateFrom) {
  query += ` AND c.start_date >= $${paramIndex}`;
  params.push(dateFrom);
  paramIndex++;
}

if (dateTo) {
  query += ` AND c.start_date <= $${paramIndex}`;
  params.push(dateTo);
  paramIndex++;
}

if (bankId && bankId !== 'all') {
  query += ` AND c.bank_id = $${paramIndex}`;
  params.push(bankId);
  paramIndex++;
}
```

## –¢–µ—Å—Ç–æ–≤—ã–µ —Å–ª—É—á–∞–∏

–≠–Ω–¥–ø–æ–∏–Ω—Ç –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Å–ª–µ–¥—É—é—â–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏:

### ‚úÖ –í–∞–ª–∏–¥–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã (—Å—Ç–∞—Ç—É—Å 200)
- `GET /api/reports/forecast?dateFrom=2024-01-01`
- `GET /api/reports/forecast?dateTo=2024-12-31`
- `GET /api/reports/forecast?dateFrom=2024-01-01&dateTo=2024-12-31`
- `GET /api/reports/forecast?bankId=all`
- `GET /api/reports/forecast?bankId=123e4567-e89b-12d3-a456-426614174000`
- `GET /api/reports/forecast?dateFrom=2024-01-01&dateTo=2024-12-31&bankId=all`

### ‚ùå –ù–µ–≤–∞–ª–∏–¥–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã (—Å—Ç–∞—Ç—É—Å 400)
- `GET /api/reports/forecast?dateFrom=01-01-2024` (–Ω–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–∞—Ç—ã)
- `GET /api/reports/forecast?dateTo=2024/12/31` (–Ω–µ–≤–µ—Ä–Ω—ã–π —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å)
- `GET /api/reports/forecast?bankId=12345` (–Ω–µ UUID —Ñ–æ—Ä–º–∞—Ç)

## –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º

–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º:
- **1.1, 1.2, 1.3, 1.4, 1.5**: –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –¥–∞—Ç–∞–º –∏ –±–∞–Ω–∫–∞–º
- **6.1, 6.2, 6.3, 6.4**: API –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
- **6.5**: –§–∏–ª—å—Ç—Ä—ã –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –¥–æ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –≥—Ä–∞—Ñ–∏–∫–æ–≤ –ø–ª–∞—Ç–µ–∂–µ–π
- **6.7**: –î–æ–±–∞–≤–ª–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –¥–ª—è –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤

## –°—Ç–∞—Ç—É—Å –∑–∞–¥–∞—á–∏

üéâ **–ó–ê–î–ê–ß–ê 2 –ü–û–õ–ù–û–°–¢–¨–Æ –í–´–ü–û–õ–ù–ï–ù–ê**

–í—Å–µ –ø–æ–¥–∑–∞–¥–∞—á–∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã. –≠–Ω–¥–ø–æ–∏–Ω—Ç –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–æ–º –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –ø—Ä–æ–≥–Ω–æ–∑–Ω–æ–≥–æ –æ—Ç—á–µ—Ç–∞.

---
*–î–∞—Ç–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è: 6 –æ–∫—Ç—è–±—Ä—è 2025*  
*–ö–æ–º–º–∏—Ç: 4a8cd15*