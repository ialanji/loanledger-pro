# Архитектура проекта: Два порта - зачем и почему?

## 🏗️ Общая архитектура

Ваш проект использует **классическую архитектуру Frontend + Backend** с разделением на два сервера:

```
┌─────────────────────────────────────────────────────────────────┐
│                    ПОЛЬЗОВАТЕЛЬ                                 │
│                 (браузер Chrome/Firefox)                        │
└─────────────────────┬───────────────────────────────────────────┘
                      │
                      ▼
┌─────────────────────────────────────────────────────────────────┐
│                 FRONTEND SERVER                                 │
│                  PORT: 8091                                     │
│                                                                 │
│  • Vite Dev Server                                              │
│  • React приложение                                             │
│  • shadcn/ui компоненты                                         │
│  • TypeScript                                                   │
│  • Tailwind CSS                                                 │
│                                                                 │
│  Проксирует /api/* запросы на backend ──────────────────────┐   │
└─────────────────────────────────────────────────────────────┼───┘
                                                              │
                                                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                 BACKEND SERVER                                  │
│                  PORT: 3001                                     │
│                                                                 │
│  • Express.js сервер                                            │
│  • REST API эндпоинты (/api/*)                                  │
│  • PostgreSQL подключение                                       │
│  • Google Sheets интеграция                                     │
│  • Бизнес-логика (ScheduleEngine)                               │
│  • Cron задачи                                                  │
└─────────────────────────────────────────────────────────────────┘
                      │
                      ▼
┌─────────────────────────────────────────────────────────────────┐
│                   DATABASE                                      │
│                 PostgreSQL                                      │
│                                                                 │
│  • Таблицы: credits, banks, payments                            │
│  • Финансовые данные                                            │
│  • Пользовательские данные                                      │
└─────────────────────────────────────────────────────────────────┘
```

## 🎯 Зачем два порта?

### **PORT 8091 - Frontend (Vite Dev Server)**
- **Назначение:** Разработка и отладка React приложения
- **Технологии:** Vite, React, TypeScript, Tailwind CSS
- **Функции:**
  - Hot Module Replacement (HMR) - мгновенное обновление при изменении кода
  - TypeScript компиляция в реальном времени
  - CSS обработка и оптимизация
  - Статические файлы (HTML, CSS, JS, изображения)
  - Proxy для API запросов на backend

### **PORT 3001 - Backend (Express Server)**
- **Назначение:** API сервер и бизнес-логика
- **Технологии:** Node.js, Express.js, PostgreSQL
- **Функции:**
  - REST API эндпоинты (`/api/*`)
  - Подключение к базе данных
  - Аутентификация и авторизация
  - Бизнес-логика (расчет платежей, отчеты)
  - Интеграции (Google Sheets)
  - Cron задачи (автоматические процессы)

## 🔄 Как они взаимодействуют?

### 1. **Proxy Configuration (vite.config.ts)**
```typescript
proxy: {
  "/api": {
    target: "http://localhost:3001",  // Все /api/* запросы идут на backend
    changeOrigin: true,
    secure: false,
    ws: true
  }
}
```

### 2. **Пример запроса:**
```
Пользователь → http://localhost:8091/reports
                     ↓
Frontend загружает страницу отчетов
                     ↓
JavaScript делает запрос: fetch('/api/reports/forecast')
                     ↓
Vite proxy перенаправляет: http://localhost:3001/api/reports/forecast
                     ↓
Backend обрабатывает запрос и возвращает JSON
                     ↓
Frontend получает данные и отображает в UI
```

## 🚀 Команды запуска

### Отдельно:
```bash
# Только frontend (порт 8091)
npm run dev

# Только backend (порт 3001)  
npm run server
```

### Вместе:
```bash
# Оба сервера одновременно
npm run dev:full
```

## 🎨 Различия интерфейсов

### **Frontend (8091) - Пользовательский интерфейс**
- Красивый UI с shadcn/ui компонентами
- Интерактивные формы и таблицы
- Графики и диаграммы (Recharts)
- Адаптивный дизайн (Tailwind CSS)
- Навигация между страницами (React Router)

### **Backend (3001) - API интерфейс**
- JSON ответы для программного использования
- REST эндпоинты (`GET /api/reports/forecast`)
- Статус коды HTTP (200, 400, 500)
- Валидация данных
- Аутентификация

## 🔧 Преимущества такой архитектуры

### ✅ **Разделение ответственности**
- Frontend: UI/UX, пользовательский опыт
- Backend: Данные, безопасность, бизнес-логика

### ✅ **Независимая разработка**
- Можно разрабатывать frontend и backend параллельно
- Разные команды могут работать над разными частями

### ✅ **Масштабируемость**
- Frontend и backend можно масштабировать независимо
- Можно добавить несколько frontend'ов (web, mobile app)

### ✅ **Технологическая гибкость**
- Frontend: современные JS фреймворки (React, Vue, Angular)
- Backend: любой язык (Node.js, Python, Java, Go)

### ✅ **Безопасность**
- API может иметь свою аутентификацию
- Валидация данных на backend
- CORS настройки

## 🛠️ В продакшене

В продакшене обычно используется один домен:
```
https://yourdomain.com/          → Frontend (статические файлы)
https://yourdomain.com/api/*     → Backend API
```

Это достигается через:
- **Nginx** как reverse proxy
- **Docker** контейнеры
- **Cloud** сервисы (Vercel + Railway, Netlify + Heroku)

## 📝 Заключение

Два порта - это стандартная практика для современных веб-приложений:
- **8091** - для разработки UI (быстрая перезагрузка, отладка)
- **3001** - для API и бизнес-логики (стабильность, безопасность)

Это позволяет эффективно разрабатывать, тестировать и масштабировать приложение! 🚀